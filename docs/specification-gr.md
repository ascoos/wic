# WIC (Web Images Cryptography) - Προδιαγραφή

## 1. Εισαγωγή

Το **WIC** (Web Images Cryptography - Κρυπτογράφηση Εικόνων Ιστοσελίδων) είναι μια νέα μορφή αρχείου (`*.wic`) που σχεδιάστηκε για να αντιμετωπίσει τις προκλήσεις της παράδοσης εικόνων στο διαδίκτυο, προσφέροντας υπερσυμπίεση και υπερκρυπτογράφηση. Τα αρχεία WIC είναι συλλογές εικόνων που συμπιέζονται με προηγμένους αλγορίθμους (π.χ. κωδικοποίηση Huffman), κρυπτογραφούνται με AES-256-CBC (μέσω OpenSSL), και αποκρυπτογραφούνται/αποσυμπιέζονται τοπικά στον browser. Αυτή η προδιαγραφή περιγράφει τη δομή, τη συμπίεση, την κρυπτογράφηση και τις απαιτήσεις ενσωμάτωσης σε browsers για το WIC.

Στόχοι του WIC:
- Μείωση του μεγέθους των αρχείων εικόνων για ταχύτερη φόρτωση ιστοσελίδων.
- Ενίσχυση της ασφάλειας με κρυπτογράφηση των εικόνων κατά τη μεταφορά.
- Διατήρηση συμβατότητας με υπάρχοντα πρότυπα ιστοσελίδων (π.χ. HTTPS, διαδρομές εικόνων).

Αυτή η προδιαγραφή αποτελεί μέρος του [Ascoos Framework](https://sourceforge.net/projects/ascoos-fw/) και διατίθεται ως **ανοιχτό πρότυπο** για την παγκόσμια κοινότητα του διαδικτύου.

## 2. Δομή Αρχείου

Ένα αρχείο WIC (`*.wic`) αποτελείται από τα εξής στοιχεία:

### 2.1. Κεφαλίδα (Header)
- **Μορφή**: JSON
- **Σκοπός**: Αποθηκεύει μεταδεδομένα για τις εικόνες της συλλογής.
- **Περιεχόμενα**:
  - `version`: Η έκδοση της μορφής WIC (π.χ. `1.0`).
  - `images`: Ένας πίνακας αντικειμένων μεταδεδομένων εικόνων, όπου κάθε αντικείμενο περιέχει:
    - `path`: Η αρχική διαδρομή της εικόνας (π.χ. `/images/photo.jpg`).
    - `type`: Ο τύπος MIME της εικόνας (π.χ. `image/jpeg`).
    - `size`: Το μέγεθος των συμπιεσμένων δεδομένων της εικόνας (σε bytes).
    - `offset`: Η θέση (σε bytes) όπου ξεκινούν τα δεδομένα της εικόνας στο αρχείο.

### 2.2. Δεδομένα (Data)
- **Μορφή**: Δυαδική (Binary)
- **Σκοπός**: Αποθηκεύει τα συμπιεσμένα και κρυπτογραφημένα δεδομένα των εικόνων.
- **Περιεχόμενα**:
  - Μια ακολουθία από μπλοκ δεδομένων εικόνων, κάθε ένα συμπιεσμένο με κωδικοποίηση Huffman και κρυπτογραφημένο με AES-256-CBC.

### Παράδειγμα Δομής Αρχείου
```json
[WIC Κεφαλίδα (JSON)]
{
  "version": "1.0",
  "images": [
    {
      "path": "/images/photo1.jpg",
      "type": "image/jpeg",
      "size": 1024,
      "offset": 512
    },
    {
      "path": "/images/photo2.png",
      "type": "image/png",
      "size": 2048,
      "offset": 1536
    }
  ]
}
[WIC Δεδομένα (Binary)]
[Εικόνα 1: Δεδομένα συμπιεσμένα με Huffman και κρυπτογραφημένα με AES-256-CBC]
[Εικόνα 2: Δεδομένα συμπιεσμένα με Huffman και κρυπτογραφημένα με AES-256-CBC]
```

## 3. Συμπίεση

### 3.1. Κεφαλίδα JSON
- Η κεφαλίδα κωδικοποιείται πρώτα ως συμβολοσειρά JSON.
- Η συμβολοσειρά JSON συμπιέζεται με gzip για μείωση του μεγέθους της.

### 3.2. Δεδομένα Εικόνων
- Κάθε εικόνα επεξεργάζεται ως εξής:
  1. **Μετατροπή σε Base64**: Τα ακατέργαστα δεδομένα της εικόνας κωδικοποιούνται ως συμβολοσειρά Base64.
  2. **Κωδικοποίηση Huffman**: Η συμβολοσειρά Base64 συμπιέζεται με τον αλγόριθμο κωδικοποίησης Huffman για συμπίεση χωρίς απώλειες.
  3. **Αποθήκευση**: Τα συμπιεσμένα δεδομένα αποθηκεύονται στο αρχείο WIC στη συγκεκριμένη θέση (offset).

## 4. Κρυπτογράφηση

### 4.1. Αλγόριθμος
- **Κρυπτογράφηση**: AES-256-CBC
- **Βιβλιοθήκη**: OpenSSL
- **Κλειδί**: Ένα κλειδί κρυπτογράφησης 256-bit που παρέχεται από την εφαρμογή.
- **IV**: Ένα διάνυσμα αρχικοποίησης (IV) 128-bit που δημιουργείται τυχαία για κάθε αρχείο WIC.

### 4.2. Διαδικασία
- Τα συμπιεσμένα δεδομένα της εικόνας (με Huffman) κρυπτογραφούνται με AES-256-CBC.
- Το IV προσαρτάται στην αρχή των κρυπτογραφημένων δεδομένων.
- Τα συνδυασμένα IV + κρυπτογραφημένα δεδομένα κωδικοποιούνται σε Base64 για αποθήκευση στο αρχείο WIC.

### 4.3. Θέματα Ασφαλείας
- Το WIC βασίζεται στο HTTPS για ασφαλή μεταφορά μεταξύ του διακομιστή και του browser.
- Το κλειδί κρυπτογράφησης πρέπει να κοινοποιείται με ασφάλεια μεταξύ του διακομιστή και του browser (π.χ. μέσω ασφαλούς καναλιού ή κρυπτογράφησης δημοσίου κλειδιού).

## 5. Ενσωμάτωση σε Browsers

### 5.1. Τύπος MIME
- Τα αρχεία WIC πρέπει να εξυπηρετούνται με τον τύπο MIME: `image/wic`.

### 5.2. Αποκρυπτογράφηση και Αποσυμπίεση
Οι browsers που υποστηρίζουν το WIC πρέπει να υλοποιήσουν τα εξής βήματα:

1. **Ανάκτηση του Αρχείου WIC**:
   - Χρήση HTTPS για ασφαλή λήψη του αρχείου `.wic`.
   - Παράδειγμα: `fetch('https://example.com/images.wic')`

2. **Ανάλυση της Κεφαλίδας**:
   - Ανάγνωση της κεφαλίδας JSON (αποσυμπιεσμένη με gzip).
   - Εξαγωγή του πίνακα `images` για να καθοριστούν οι διαδρομές, οι τύποι, τα μεγέθη και οι θέσεις των εικόνων.

3. **Αποκρυπτογράφηση των Δεδομένων**:
   - Χρήση του Web Crypto API για αποκρυπτογράφηση των δεδομένων της εικόνας:
     - Αλγόριθμος: AES-CBC
     - Κλειδί: Το κλειδί κρυπτογράφησης 256-bit (παρέχεται με ασφάλεια στον browser).
     - IV: Εξάγεται από τα πρώτα 16 bytes των κρυπτογραφημένων δεδομένων.
   - Παράδειγμα:
     ```javascript
     const cryptoKey = await crypto.subtle.importKey(
         'raw',
         new TextEncoder().encode('your_secret_key'),
         { name: 'AES-CBC' },
         false,
         ['decrypt']
     );
     const decrypted = await crypto.subtle.decrypt(
         { name: 'AES-CBC', iv: ivBuffer },
         cryptoKey,
         encryptedBuffer
     );
     ```

4. **Αποσυμπίεση των Δεδομένων**:
   - Αποσυμπίεση των αποκρυπτογραφημένων δεδομένων με αποκωδικοποίηση Huffman.
   - Μετατροπή της αποσυμπιεσμένης συμβολοσειράς Base64 πίσω σε δυαδικά δεδομένα εικόνας.

5. **Απόδοση των Εικόνων**:
   - Δημιουργία αντικειμένων `Image` με τα αποκρυπτογραφημένα/αποσυμπιεσμένα δεδομένα.
   - Ορισμός του χαρακτηριστικού `src` στη `path` από την κεφαλίδα για διατήρηση της αρχικής διεύθυνσης URL.
   - Παράδειγμα:
     ```javascript
     const img = new Image();
     img.src = imageData.path; // π.χ. '/images/photo.jpg'
     img.src = `data:${imageData.type};base64,${decompressedData}`;
     document.body.appendChild(img);
     ```

### 5.3. Εναλλακτική Λύση για Μη Υποστηριζόμενους Browsers
- Για browsers που δεν υποστηρίζουν εγγενώς το WIC, μπορεί να χρησιμοποιηθεί ένα JavaScript polyfill (βλ. τη [βιβλιοθήκη WIC JavaScript](https://github.com/alexsoft-software/wic/blob/main/wic.js)).

## 6. Θέματα Ασφαλείας

- **Απαίτηση HTTPS**: Τα αρχεία WIC πρέπει να εξυπηρετούνται μέσω HTTPS για ασφαλή μεταφορά.
- **Διαχείριση Κλειδιών**: Το κλειδί κρυπτογράφησης πρέπει να διαχειρίζεται με ασφάλεια και να κοινοποιείται μεταξύ διακομιστή και browser.
- **Προστασία από Παραποίηση**: Η κεφαλίδα JSON μπορεί να περιλαμβάνει ψηφιακή υπογραφή (π.χ. HMAC-SHA256) για επαλήθευση της ακεραιότητας του αρχείου WIC.

## 7. Οφέλη του WIC

- **Απόδοση**: Οι υπερσυμπιεσμένες εικόνες μειώνουν τη χρήση εύρους ζώνης και βελτιώνουν τους χρόνους φόρτωσης σελίδων.
- **Ασφάλεια**: Οι κρυπτογραφημένες εικόνες προστατεύουν ευαίσθητο περιεχόμενο κατά τη μεταφορά.
- **Συμβατότητα**: Διατηρεί τις αρχικές διαδρομές των εικόνων, εξασφαλίζοντας ομαλή ενσωμάτωση με υπάρχουσες ιστοσελίδες.
- **Επεκτασιμότητα**: Κατάλληλο για μεγάλες συλλογές εικόνων, καθώς η κεφαλίδα JSON επιτρέπει αποτελεσματική ευρετηρίαση.

## 8. Σημειώσεις Υλοποίησης

### 8.1. Δημιουργία από την Πλευρά του Διακομιστή
- Χρησιμοποιήστε την κλάση `TWICHandler` στο Ascoos Framework για τη δημιουργία αρχείων WIC (βλ. [README.md](../README.md) για παραδείγματα).

### 8.2. Απόδοση από την Πλευρά του Πελάτη
- Οι browsers θα πρέπει να υλοποιήσουν εγγενή υποστήριξη για τον τύπο MIME `image/wic`.
- Μέχρι να υπάρξει εγγενής υποστήριξη, μπορεί να χρησιμοποιηθεί το [JavaScript polyfill του WIC](https://github.com/alexsoft-software/wic/blob/main/wic.js).

## 9. Μελλοντικές Κατευθύνσεις

- **Συμπίεση με Απώλειες**: Προσθήκη υποστήριξης για συμπίεση με απώλειες (π.χ. μετατροπή σε WebP) για περαιτέρω μείωση του μεγέθους αρχείων.
- **Ασύμμετρη Κρυπτογράφηση**: Χρήση RSA για ασφαλή ανταλλαγή κλειδιών μεταξύ διακομιστή και browser.
- **Τυποποίηση**: Συνεργασία με το W3C και κατασκευαστές browsers για να γίνει το WIC αναγνωρισμένο πρότυπο διαδικτύου.

## 10. Επικοινωνία

Για ερωτήσεις, σχόλια ή ευκαιρίες συνεργασίας, επικοινωνήστε:

- **Συγγραφέας**: Δρογκίδης Χρήστος
- **Ιστοσελίδα**: [ascoos.com](https://ascoos.com)
- **GitHub Issues**: [Άνοιγμα θεμάτων](https://github.com/alexsoft-software/wic/issues)

---

Αυτή η προδιαγραφή είναι ένα ζωντανό έγγραφο και θα ενημερώνεται καθώς το WIC εξελίσσεται. Οι συνεισφορές είναι ευπρόσδεκτες!
